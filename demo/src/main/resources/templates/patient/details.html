<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Patient Details</title>
    <style>
        /* Stiluri simple pentru tabel */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }

        .section-title { margin-top: 30px; border-bottom: 2px solid #333; padding-bottom: 5px; }
        .empty-msg { color: #666; font-style: italic; margin-top: 10px; }
    </style>
</head>
<body>

<h1>Patient Details</h1>

<!-- INFO PACIENT -->
<div>
    <p><strong>ID:</strong> <span th:text="${patient.id}"></span></p>
    <p><strong>Name:</strong> <span th:text="${patient.name}"></span></p>
    <p><strong>Address:</strong> <span th:text="${patient.address}"></span></p>
</div>

<!-- ISTORIC PROGRAMĂRI -->
<h2 class="section-title">Appointments History</h2>

<!-- Verificăm dacă pacientul are programări -->
<div th:if="${not #lists.isEmpty(patient.appointments)}">
    <table>
        <thead>
        <tr>
            <th>Date</th>
            <th>Department</th>
            <th>Doctor/Staff</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- Iterăm prin lista de programări a pacientului -->
        <tr th:each="app : ${patient.appointments}">
            <td th:text="${app.admissionDate}"></td>

            <!-- Folosim ?. pentru siguranță -->
            <td th:text="${app.department?.name}"></td>
            <td th:text="${app.medicalStaff?.name}"></td>
            <td th:text="${app.status}"></td>

            <td>
                <!-- Link către detaliile programării -->
                <a th:href="@{/appointments/details/{id}(id=${app.id})}">View</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Mesaj dacă nu există programări -->
<div th:if="${#lists.isEmpty(patient.appointments)}" class="empty-msg">
    <p>No appointments found for this patient.</p>
</div>

<br/>
<br/>

<!-- NAVIGARE -->
<a th:href="@{/patients}">Back to List</a>
&nbsp;|&nbsp;
<a th:href="@{/patients/edit/{id}(id=${patient.id})}">Edit Patient</a>
&nbsp;|&nbsp;
<a th:href="@{/patients/delete/{id}(id=${patient.id})}"
   onclick="return confirm('Are you sure you want to delete this patient?')">Delete Patient</a>

</body>
</html>